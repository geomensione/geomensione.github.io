<!DOCTYPE html>
<html>
<head>
<title>my worm</title>
<style>
body{
	margin: 0;
	overflow: hidden;
}
canvas{
	width: 100%;
	height: 100%;
}
</style>
</head>
<body>
    <canvas id="gameScreen">
      What, no canvas support? D:
    </canvas>
 <script>
	"use strict";
	window.a = document.getElementsByTagName('canvas')[0];
	window.b = document.getElementsByTagName('body')[0];
	window.c = window.a.getContext('2d');
	window.d = document;
	a.width = window.innerWidth;
	a.height = window.innerHeight;
	/*
	JS1K start
	*/
	//Init
	var g = {};
	g.w = window.innerWidth;
	g.h = window.innerHeight;
	g.r = 24;
	g.s = 1;
	g.fr = 100;
	
	function direction(x,y){
		if(x < a.width/3)
			worm.dir = 'left';
		else	
			if(x > (a.width/3)*2)
				worm.dir = 'right';
			else
				if(y > a.height/2)
					worm.dir = 'down';
				else
					worm.dir = 'up';
	}
	 
	a.ontouchstart = function(e){
		direction(e.touch[0].clientX,e.touch[0].clientY);
	}
	
	a.onmousedown = function(e){
		direction(e.clientX,e.clientY);
	};
	 
	d.onkeydown = function(e){
		switch(e.keyCode){
			case 37:
				worm.dir = 'left';
				break;
			case 38:
				worm.dir = 'up';
				break;
			case 39:
				worm.dir = 'right';
				break;
			case 40:
				worm.dir = 'down';
				break;
		}
	}
	
	var worm = function(){
		this.draw = () => {
			if(!this.body){
				this.body = [];
				var coord = {x: Math.floor(Math.random() * (g.rx-g.s)),y: Math.floor(Math.random() * (g.ry-g.s))};
				this.body.push(coord);
			}
			if(this.length>1)
				for(let l = 0;l<this.length-1;l++)
					this.body[l+1] = this.body[l];
			switch(this.dir){
				case 'left':
					this.left();
					break;
				case 'right':
					this.right();
					break;
				case 'up':
					this.up();
					break;
				case 'down':
					this.down();
					break;
			}
			//inizio a disegnare dalla coda
			for(var b = this.body.length-1;b>=0;b--)
			{
				if(g.fb[this.body[b].x][this.body[b].y][0] === 'FF' && g.fb[this.body[b].x][this.body[b].y][1] === 'FF' && g.fb[this.body[b].x][this.body[b].y][1] === 'FF')
					this.end();
				else 
					if(g.fb[this.body[b].x][this.body[b].y][0] === 'FF' && g.fb[this.body[b].x][this.body[b].y][1] === '00' && g.fb[this.body[b].x][this.body[b].y][1] === '00')
						seed.hit();
					else
						g.fb[this.body[b].x][this.body[b].y] = ['FF','FF','FF'];
			}
		}
		this.length = 0;
		this.up = () => {
			if((this.body[0].y - 1)>=0)
				this.body[0].y--
			else
				this.body[0].y = g.ry-1;
		}
		this.down = () => {
			if((this.body[0].y + 1)<g.ry)
				this.body[0].y++
			else
				this.body[0].y = 0;
		}
		this.left = () => {
			if((this.body[0].x - 1) >= 0)
				this.body[0].x--;
			else
				this.body[0].x = g.rx-1;
		}
		this.right = () => {
			if((this.body[0].x + 1) < g.rx)
				this.body[0].x++;
			else
				this.body[0].x = 0;
		}
		return{
			draw: draw
		}
	};
	
	
	var seed = function(){
		this.draw = () => {
			if(!this.x){
				this.x = Math.floor(Math.random() * (g.rx-g.s));
				this.y = Math.floor(Math.random() * (g.ry-g.s));
			}
			if(g.fb[this.x][this.y] !== ['FF','FF','FF'])
				g.fb[this.x][this.y] = ['FF','00','00'];
			else
				this.draw();
		}
		this.hit = () => {
			delete this.x;
			delete this.y;
		}
		return{
			draw: draw,
			hit: hit
		}
	};
	
	function gr(){
		var w = g.w;
		var h = g.h;
		var ox, oy = 0;
		if(h<w){
			ox = Math.round(h/g.r);
			g.ry = Math.round(h/ox);
			g.rx = Math.round(w/ox);
		}else{
			ox = Math.round(w/g.r);
			g.rx = Math.round(w/ox);
			g.ry = Math.round(h/ox);
		}
		g.o = ox;
		g.fb = [];
		var rx = g.rx;
		var ry = g.ry;
		for(var i = 0;i<rx;i++){
			g.fb[i] = [];
			for(var d = 0;d<ry;d++){
				//qui setta il fb
				g.fb[i][d] = ['00', '00', '00'];
			}
		}
		g_worm.draw();
		g_seed.draw();
		/*
		var x = Math.floor(Math.random() * (g.rx-g.s));
		var y = Math.floor(Math.random() * (g.ry-g.s));
		for(var xo = 0;xo<g.s;xo++)
		{
			for(var yo = 0;yo<g.s;yo++)
			{
				if(g.sh[yo][xo] === 'W')
					g.fb[x+xo][y+yo] = ['FF','FF','FF'];
			}
		}
		*/
		
	}
	 
	function dr(){
		var rx = g.rx;
		var ry = g.ry;
		var o = g.o;
		var cx = 0, cy = 0;
		for(var i = 0;i<rx;i++){
			for(var d = 0;d<ry;d++){
				c.fillStyle = "#"+g.fb[i][d][0]+g.fb[i][d][1]+g.fb[i][d][2];
				c.fillRect(cx,cy,o,o);
				cy += o;
			}
			cx += o;
			cy = 0;
		}
		
		
	}
	var g_worm, g_seed;
	function l(){
		g_worm = new worm();
		g_seed = new seed();
		g.l = setInterval(function() {
			gr();
			dr();
		}, g.fr);
	}
	 
	l();
 </script>
</body></html>
