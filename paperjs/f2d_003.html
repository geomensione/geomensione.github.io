<html>
<head>
	<style>
		#myCanvas{
			width:100%;
			height: 100%;
		}
	</style>
  <script src="js/paper-full.min.js"></script>
  <script src="js/tangents.js"></script>
<script>
	var tool = {};
	var segment, path;
	var movePath = false;
		
	window.onload = function() {
		document.title = 'f2d_003';
		// Get a reference to the canvas object
		var canvas = document.getElementById('myCanvas');
		// Create an empty project and a view for the canvas:
		paper.setup(canvas);
		tool = new paper.Tool();
		var values = {
			paths: 50,
			minPoints: 5,
			maxPoints: 15,
			minRadius: 30,
			maxRadius: 90
		};

		var hitOptions = {
			segments: true,
			stroke: true,
			fill: true,
			tolerance: 5
		};

		createPaths();

		function createPaths() {
			var radiusDelta = values.maxRadius - values.minRadius;
			var pointsDelta = values.maxPoints - values.minPoints;
			for (var i = 0; i < values.paths; i++) {
				var radius = values.minRadius + Math.random() * radiusDelta;
				var points = values.minPoints + Math.floor(Math.random() * pointsDelta);
				var path = createBlob(view.size * paper.Point.random(), radius, points);
				var lightness = (Math.random() - 0.5) * 0.4 + 0.4;
				var hue = Math.random() * 360;
				path.fillColor = { hue: hue, saturation: 1, lightness: lightness };
				path.strokeColor = 'black';
			};
		}

		function createBlob(center, maxRadius, points) {
			var path = new paper.Path();
			path.closed = true;
			for (var i = 0; i < points; i++) {
				var delta = new paper.Point({
					length: (maxRadius * 0.5) + (Math.random() * maxRadius * 0.5),
					angle: (360 / points) * i
				});
				path.add(center + delta);
			}
			path.smooth();
			return path;
		}

		function onMouseDown(event) {
			segment = path = null;
			var hitResult = paper.project.hitTest(event.point, hitOptions);
			if (!hitResult)
				return;

			if (event.modifiers.shift) {
				if (hitResult.type == 'segment') {
					hitResult.segment.remove();
				};
				return;
			}

			if (hitResult) {
				path = hitResult.item;
				if (hitResult.type == 'segment') {
					segment = hitResult.segment;
				} else if (hitResult.type == 'stroke') {
					var location = hitResult.location;
					segment = path.insert(location.index + 1, event.point);
					path.smooth();
				}
			}
			movePath = hitResult.type == 'fill';
			if (movePath)
				paper.project.activeLayer.addChild(hitResult.item);
		}

		function onMouseMove(event) {
			paper.project.activeLayer.selected = false;
			if (event.item)
				event.item.selected = true;
		}

		function onMouseDrag(event) {
			if (segment) {
				segment.point += event.delta;
				path.smooth();
			} else if (path) {
				path.position += event.delta;
			}
		}
		
		tool.onMouseDown = onMouseDown;
		tool.onMouseMove = onMouseMove;
		tool.onMouseDrag = onMouseDrag;
	}
</script>
</head>
<body>
<canvas id="myCanvas" resize></canvas>
</body>
</html>
