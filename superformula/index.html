<html>
<head></head>
<body>
  m,n1,n2,n3,a,b
  
  <input type='text' id="m" value="3" ></input>
  <input type='text' id="n1" value="4" ></input>
  <input type='text' id="n2" value="5" ></input>
  <input type='text' id="n3" value="6" ></input>
  <input type='text' id="a" value="1" ></input>
  <input type='text' id="b" value="2" ></input>
  <input type='button' id="addShape" value="add shape" onclick="AddRenderFormula()"></input>
  <input type='button' value="asterisk" onclick="AddRenderFormula(12, 0.3, 1, 10, 0.55, 1.1)"></input>
  <input type='button' value="bean" onclick="AddRenderFormula(2, 1, 4, 8, 1.8, 1.8)"></input>
  <input type='button' value="butterfly" onclick="AddRenderFormula(3, 1, 6, 2, 2, 4)"></input>
  <input type='button' value="circle" onclick="AddRenderFormula(4, 2, 2, 2, 50, 50)"></input>
  <input type='button' value="clover" onclick="AddRenderFormula(6, 0.3, 0, 10, 1.1, 1.1)"></input>
  <input type='button' value="cloverFour" onclick="AddRenderFormula(8, 10, -1, -8, 0.000000000000001,0.000000000000001)"></input>
  <input type='button' value="cross" onclick="AddRenderFormula(8, 1.3, 0.1, 8, 10000000, 10000000)"></input>
  <input type='button' value="diamond" onclick="AddRenderFormula(4, 1, 1, 1, 100, 100)"></input>
  <input type='button' value="drop" onclick="AddRenderFormula(1, 0.5, 0.5, 0.5, 100, 100)"></input>
  <input type='button' value="ellipse" onclick="AddRenderFormula(4, 2, 2, 2, 90, 60)"></input>
  <input type='button' value="gear" onclick="AddRenderFormula(19, 100, 50, 50, 1000, 1000)"></input>
  <input type='button' value="heart" onclick="AddRenderFormula(1, 0.8, 1, -8, 1, 0.18)"></input>
  <input type='button' value="heptagon" onclick="AddRenderFormula(7, 1000, 400, 400, 1, 0.18)"></input>
  <input type='button' value="hexagon" onclick="AddRenderFormula(6, 1000, 400, 400, 1, 1)"></input>
  <input type='button' value="malteseCross" onclick="AddRenderFormula(8, 0.9, 0.1, 100, 1, 1)"></input>
  <input type='button' value="pentagon" onclick="AddRenderFormula(5, 1000, 600, 600, 1, 1)"></input>
  <input type='button' value="rectangle" onclick="AddRenderFormula(4, 100, 100, 100, 2, 1)"></input>
  <input type='button' value="roundedStar" onclick="AddRenderFormula(5, 2, 7, 7, 2, 1)"></input>
  <input type='button' value="square" onclick="AddRenderFormula(4, 100, 100, 100, 1, 1)"></input>
  <input type='button' value="star" onclick="AddRenderFormula(5, 30, 100, 100, 1, 1)"></input>
  <input type='button' value="triangle" onclick="AddRenderFormula(3, 100, 200, 200, 1, 1)"></input>

<canvas id=c>
</canvas>
  
<script>
//superformula params
var types = {
  asterisk: {m: 12, n1: .3, n2: 0, n3: 10, a: 1, b: 1},
  bean: {m: 2, n1: 1, n2: 4, n3: 8, a: 1, b: 1},
  butterfly: {m: 3, n1: 1, n2: 6, n3: 2, a: .6, b: 1},
  circle: {m: 4, n1: 2, n2: 2, n3: 2, a: 1, b: 1},
  clover: {m: 6, n1: .3, n2: 0, n3: 10, a: 1, b: 1},
  cloverFour: {m: 8, n1: 10, n2: -1, n3: -8, a: 1, b: 1},
  cross: {m: 8, n1: 1.3, n2: .01, n3: 8, a: 1, b: 1},
  diamond: {m: 4, n1: 1, n2: 1, n3: 1, a: 1, b: 1},
  drop: {m: 1, n1: .5, n2: .5, n3: .5, a: 1, b: 1},
  ellipse: {m: 4, n1: 2, n2: 2, n3: 2, a: 9, b: 6},
  gear: {m: 19, n1: 100, n2: 50, n3: 50, a: 1, b: 1},
  heart: {m: 1, n1: .8, n2: 1, n3: -8, a: 1, b: .18},
  heptagon: {m: 7, n1: 1000, n2: 400, n3: 400, a: 1, b: 1},
  hexagon: {m: 6, n1: 1000, n2: 400, n3: 400, a: 1, b: 1},
  malteseCross: {m: 8, n1: .9, n2: .1, n3: 100, a: 1, b: 1},
  pentagon: {m: 5, n1: 1000, n2: 600, n3: 600, a: 1, b: 1},
  rectangle: {m: 4, n1: 100, n2: 100, n3: 100, a: 2, b: 1},
  roundedStar: {m: 5, n1: 2, n2: 7, n3: 7, a: 1, b: 1},
  square: {m: 4, n1: 100, n2: 100, n3: 100, a: 1, b: 1},
  star: {m: 5, n1: 30, n2: 100, n3: 100, a: 1, b: 1},
  triangle: {m: 3, n1: 100, n2: 200, n3: 200, a: 1, b: 1}
};
  
var oldCoordX,oldCoordY;
var scene = [];
var selectedObject;
var context = c.getContext("2d");
function AddRenderFormula(m,n1,n2,n3,a,b){
  var sf = new superformulaobj();
  if(isFinite(m) && isFinite(n1) && isFinite(n2) && isFinite(n3) && isFinite(a) && isFinite(b))
    sf.renderFormula(m,n1,n2,n3,a,b);
  else
    sf.renderFormula();
  scene.push(sf);
  render();
}

c.addEventListener('mousemove',(e)=>{
  let ret = false;
  const rect = c.getBoundingClientRect();
  let x = e.clientX - rect.left;
  let y = e.clientY - rect.top;
  let scene_length = scene.length;
  for(let o = 0;o<scene_length;o++){
    ret = scene[o].hit(x,y);
    if(ret){
      selectedObject = o;
      if(mouseDown)
        scene[o].move(x,y);
    }else{
      selectedObject = undefined;
    }
    render();
  }
})

c.addEventListener('mousedown',(e)=>{
  const rect = c.getBoundingClientRect();
  oldCoordX = e.clientX - rect.left;
  oldCoordY = e.clientY - rect.top;
  mouseDown = true;
})
  
document.addEventListener('mouseup',(e)=>{
  mouseDown = false;
})
  
  function superformulaobj(){
    var a,b,m,n1,n2,n3;
    var points = [];
    var moveX = 200;
    var moveY = 200;
    var lineWidth = 1;
    var color = '#000';
    var selected_color = '#F00';
    var numberOfPoints = 360;
    var minX = 0, maxX = 0, minY = 0, maxY = 0;
    var select = false;
    var offsetX = 0,offsetY = 0;
    
    function hit(x,y){
      if(x<=maxX && x>=minX && y<=maxY && y>=minY)
        select = true;
      else
        select = false;
      console.log(`x: ${x}, y: ${y}, maxX: ${maxX}, minX: ${minX}, maxY: ${maxY}, minY: ${minY}, select:${select}`)
      return select;
    }
    
    function move(x,y){
      
        offsetX = x - oldCoordX;
        offsetY = y - oldCoordY;
        oldCoordX = x;
        oldCoordY = y;
    }
    
    function superformula(phi,a,b,m,n1,n2,n3) {
      return Math.pow( Math.pow( Math.abs( Math.cos(m * phi / 4) / a ), n2 ) + Math.pow( Math.abs( Math.sin(m * phi / 4) / b ), n3 ), -1 / n1 );
    }
    
    
    function drawFormula(m,n1,n2,n3,a,b) {
      
      context.beginPath();
      var points_length = points.length;
      for (let index = 0; index < numberOfPoints; index++) {
        var x,y;
        points[index]._x += offsetX;
        x = points[index]._x;
        points[index]._y += offsetY;
        y = points[index]._y;
        if (index === 0) {
          context.moveTo(x,y);
        } else {
          context.lineTo(x,y);
        }
      }
      context.closePath();
      context.lineWidth = lineWidth;
      if(select)
        context.strokeStyle = selected_color;
      else
        context.strokeStyle = color;
      context.stroke();
    }
    
    function renderFormula(m,n1,n2,n3,a,b) {
      
      if(!isFinite(a))
        a = -(-document.getElementById('a').value);
      else
        document.getElementById('a').value = a;

      if(!isFinite(b))
        b = -(-document.getElementById('b').value);
      else
        document.getElementById('b').value = b;
      if(!isFinite(m))
        m = -(-document.getElementById('m').value);
      else
        document.getElementById('m').value = m;
      if(!isFinite(n1))
        n1 = -(-document.getElementById('n1').value);
      else
        document.getElementById('n1').value = n1;
      if(!isFinite(n2))
        n2 = -(-document.getElementById('n2').value);
      else
        document.getElementById('n2').value = n2;
      if(!isFinite(n3))
        n3 = -(-document.getElementById('n3').value);
      else
        document.getElementById('n3').value = n3;
      
      for (let index = 0; index < numberOfPoints; index++) {
        var x,y;
        const radius = superformula(index / numberOfPoints * Math.PI * 2,a,b,m,n1,n2,n3);
        x = Math.cos(index / numberOfPoints * Math.PI * 2) * radius + moveX;
        y = Math.sin(index / numberOfPoints * Math.PI * 2) * radius + moveY;
        
        if(index===0){
          minX=x;
          maxX=x;
          minY=y;
          maxY=y;
        }else{
          if(x<minX)
            minX=x;
          if(x>maxX)
            maxX=x;
          if(y<minY)
            minY=y;
          if(y>maxY)
            maxY=y;
        }

        points.push({_x:x,_y:y});
      }
    }
    return{
      renderFormula: renderFormula,
      drawFormula: drawFormula,
      hit: hit,
      move: move
    }
  }


function render() {
  context.clearRect(0,0,c.width,c.height);
  
  var scene_length = scene.length;
  for(let o = 0;o<scene_length;o++)
    scene[o].drawFormula();
  
}
  
function resize() {
  c.width = window.innerWidth;
  c.height = window.innerHeight;
}

//window.requestAnimationFrame(frame);
window.addEventListener("resize", resize);
window.dispatchEvent(new Event("resize"));


</script>
</body>
</html>
